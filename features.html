<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SPEC Site</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div id="header" class="header-placeholder"></div>
  <script src="header.js" defer></script>
  <main>
    <div class="content">
      <h1>How to Use Each Feature</h1>

<p>
  This page explains the main features available in the SPEC interface:
  <strong>Calibration</strong> and <strong>PIV Functions</strong>. Together,
  these tools let you align the camera view with the water surface, capture
  frames, run PIV on them, and automatically repeat the process when conditions
  are good.
</p>

<hr>

<h2>1. Calibration</h2>

<p>
  The <strong>Calibration</strong> screen is used to align the camera view with
  the physical water surface and define the trapezoid region where PIV will be
  performed. Proper calibration is important for getting meaningful velocity
  measurements.
</p>

<h3>Calibration Controls</h3>
<ul>
  <li><strong>Adjust camera tilt (up-down angle):</strong>
    This control changes the vertical tilt of the camera in the transformed
    view. Use it to match the apparent water surface to the expected horizontal
    position.</li>

  <li><strong>Set roll (side-to-side angle) to 0°:</strong>
    The roll adjustment lets you correct any side-to-side rotation of the
    camera. In most cases, you want the roll to be <strong>0°</strong> so that
    the water surface appears level. If the image looks rotated, adjust this
    until edges that should be horizontal look level.</li>

  <li><strong>Move trapezoid points:</strong>
    The trapezoid defines the region of interest for PIV. You can drag the
    corner points to match the actual area on the water surface where you want
    to measure velocity. The top edge usually represents the far shoreline and
    the bottom edge the near edge of the measurement region.</li>

  <li><strong>Show transformed image:</strong>
    After adjusting tilt, roll, and trapezoid points, you can view the
    <strong>transformed image</strong>. This shows how the camera view is
    warped into a top-down–like reference frame used for PIV. Use this to
    confirm that the region of interest is correctly aligned before running
    PIV.</li>
</ul>

<p>
  Once the calibration looks correct (angles set and trapezoid aligned), you
  can move on to the PIV functions.
</p>

<hr>

<h2>2. PIV Functions</h2>

<p>
  The <strong>PIV Functions</strong> section is where you actually run PIV on
  captured frames. There are three main controls:
  <strong>Run PIV</strong>, <strong>Start Auto PIV</strong>, and
  <strong>Stop Auto PIV</strong>.
</p>

<h3>2.1 Run PIV (One-Shot Pipeline)</h3>

<p>
  The <strong>Run PIV</strong> button executes a full one-shot pipeline:
</p>

<ol>
  <li><strong>Collect IMU data:</strong>
    The system reads IMU data for this run (if available) so you can associate
    motion measurements with the PIV results.</li>

  <li><strong>Collect raw frames:</strong>
    A batch of raw image frames is captured from the camera or loaded from the
    current video source.</li>

  <li><strong>Preprocess frames:</strong>
    The raw frames are preprocessed (for example, cropping, filtering,
    normalizing) to prepare them for the FFT-based PIV analysis.</li>

  <li><strong>Compute the goodness metric:</strong>
    The PIV output for this batch is evaluated with a
    <strong>goodness metric</strong>. This metric measures the quality or
    reliability of the velocity field. If the goodness metric is above a
    configured threshold, the system considers the result acceptable.</li>

  <li><strong>Statistic generation (if above threshold):</strong>
    When the goodness metric is above the threshold, SPEC:
    <ul>
      <li>aggregates this batch’s results into the total statistics,</li>
      <li>updates any summary values (averages, distributions, etc.),</li>
      <li>and stores the results for later viewing.</li>
    </ul>
  </li>

  <li><strong>Running the PIV (FFT process):</strong>
    For each batch, SPEC sends the images through an FFT-based PIV computation:
    <ul>
      <li>image pairs are processed to find particle displacements,</li>
      <li>velocity vectors are computed from those displacements,</li>
      <li>and the resulting fields are collected.</li>
    </ul>
  </li>

  <li><strong>Compiling and adding results:</strong>
    The vectors and derived quantities from all processed frames in the batch
    are compiled and added into the total results for the run.</li>

  <li><strong>Generating PNGs and updating data visualization:</strong>
    After PIV is complete, SPEC generates PNG images and updates plots / data
    visualizations so you can see the velocity fields and related metrics
    graphically.</li>
</ol>

<p>
  In short, <strong>Run PIV</strong> performs the entire pipeline once:
  capture → preprocess → analyze → check quality → update statistics and
  visualizations.
</p>

<h3>2.2 Start Auto PIV</h3>

<p>
  The <strong>Start Auto PIV</strong> button enables a continuous,
  looped version of the PIV pipeline:
</p>

<ul>
  <li>The system repeatedly captures new batches of frames.</li>
  <li>Each batch is passed through the same one-shot pipeline (IMU, preprocess,
      PIV, goodness metric, statistics, visualization).</li>
  <li>After each run, SPEC checks the <strong>goodness metric</strong>.</li>
  <li>If the metric stays above the threshold, the loop continues and
      <strong>Run PIV</strong> is called again automatically.</li>
</ul>

<p>
  This mode is useful when you want ongoing measurements over time, as long as
  the image quality remains acceptable.
</p>

<h3>2.3 Stop Auto PIV</h3>

<p>
  The <strong>Stop Auto PIV</strong> button stops the continuous Auto PIV loop.
  Once you click this:
</p>

<ul>
  <li>No further batches are captured automatically.</li>
  <li>No more calls to the one-shot <strong>Run PIV</strong> pipeline are made.</li>
  <li>The interface remains available to view results or run a manual
      one-shot PIV again if desired.</li>
</ul>

<p>
  This gives the operator full control: you can test a single run with
  <strong>Run PIV</strong>, then switch to continuous processing with
  <strong>Start Auto PIV</strong>, and stop it at any time with
  <strong>Stop Auto PIV</strong>.
</p>

<hr>

<h2>Summary</h2>

<p>
  In summary, the main workflow is:
</p>

<ol>
  <li>Use <strong>Calibration</strong> to adjust tilt, roll, and trapezoid
      points and verify the transformed image.</li>
  <li>Use <strong>Run PIV</strong> to perform a single full pipeline run and
      inspect the results.</li>
  <li>When you are satisfied with the setup, use
      <strong>Start Auto PIV</strong> for continuous measurements, and
      <strong>Stop Auto PIV</strong> to halt the loop.</li>
</ol>

    </div>
  </main>
</body>
</html>
